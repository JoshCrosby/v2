function wd3LineChart(t,e){function a(t){for(var a=Object.keys(t[0]),i=new Array,o={},n=0;n<a.length;n++){a[n];a[n]!=e.label&&(i.push(a[n]),o[a[n]]="cls_"+a[n].replace(/[^a-z0-9]/gi,""))}t.forEach(function(t){switch(e.xtype.toLowerCase()){case"num":t[e.label]=+t[e.label];break;case"date":t[e.label]=new Date(t[e.label])}for(var a=0;a<i.length;a++){var r=i[a];t[r]=+t[r]}}),void 0!=e.debug&&(console.log("data:",t),console.log("keys:",a),console.log("ykeys:",i),console.log("label:",e.label));for(var l={},n=0;n<i.length;n++){var d=i[n];l[d]=d3.svg.line().interpolate("basis").x(function(t){return g(t[e.label])}).y(function(t){return h(+t[d])})}void 0!=e.debug&&console.log("lines: ",l),g.domain(d3.extent(t,function(t){return t[e.label]})),h.domain([d3.min(t,function(t){for(var e=new Array,a=0;a<i.length;a++){var r=i[a];e.push(+t[r])}return Math.min.apply(null,e)})+-1,d3.max(t,function(t){for(var e=new Array,a=0;a<i.length;a++){var r=i[a];e.push(+t[r])}return Math.max.apply(null,e)})+1]),u.call(p),v.call(f);var b=s.selectAll("path.line")[0];void 0!=e.debug&&console.log("plines: ",b),c.selectAll("span").remove();for(var n=0;n<i.length;n++){var d=i[n],m=c.append("span");m.append("span").attr("class","icon-blank").style("color",r.range()[n]),m.append("span").text(" "+d+" ");var y=s.selectAll("path.line."+o[d]);void 0!=e.debug&&console.log("linegraph: ",y);for(var w=0;w<b.length;w++)if(void 0!=b[w].getAttribute("class")){var x=b[w].getAttribute("class");if(void 0!=x){var k=x.indexOf(o[d]);-1!=k&&b.splice(w,1)}}y.empty()&&(y=s.append("path").attr("class","line "+o[d]).style("stroke",r.range()[n]).style("fill","none").style("stroke-width","2px")),y.transition().ease("linear").duration(500).style("stroke",r.range()[n]).attr("d",l[d](t))}void 0!=e.debug&&console.log("remove plines: ",b);for(var w=0;w<b.length;w++)b[w].remove();e={},l={}}void 0==t&&(t="body");var i=document.querySelector(t);if(void 0==i)return void console.log("wd3LineChart Error: undefined parent");void 0==e&&(e={}),void 0==e.top&&(e.top=20),void 0==e.right&&(e.right=20),void 0==e.bottom&&(e.bottom=30),void 0==e.left&&(e.left=50),void 0==e.width&&(e.width=getWidth(i)-e.left-e.right),void 0==e.height&&(e.height=getHeight(i)-e.top-e.bottom),void 0==e.padding&&(e.padding=1),void 0==e.yticks&&(e.yticks=Math.round(e.height/30)),void 0==e.xticks&&(e.xticks=Math.round(e.width/30)),void 0==e.xtype&&(e.xtype="date"),void 0==e.label&&(e.label="label"),void 0==e.duration&&(e.padding=10),e.height<20&&(e.height=300),e.width<20&&(e.width=300),void 0!=e.debug&&console.log("Params:",e);var r=d3.scale.category20(),o=40,n=e.width-e.left-e.right,l=e.height-e.top-e.bottom;if(void 0!=e.debug&&console.log("innerWidth:",n),void 0!=e.debug&&console.log("innerHeight:",l),void 0==document.querySelector(t+" svg")){var d=d3.select(t).append("svg").attr("width",e.width).attr("height",e.height),s=d.append("g").attr("transform","translate("+e.left+","+e.top+")").attr("data-g","one"),c=d3.select(t).append("div").attr("class","legend").style("margin-left",e.left+"px").style("margin-right",e.right+"px"),u=s.append("g").style("stroke","grey").style("fill","none").style("stroke-width","1px").attr("class","x-axis").attr("transform","translate(0,"+l+")"),v=s.append("g").attr("class","y-axis").style("stroke","grey").style("fill","none").style("stroke-width","1px");v.append("text").style("text-anchor","middle").attr("transform","translate(-"+o+","+l/2+") rotate(-90)").attr("class","label")}else{var d=d3.select(t+" svg"),c=d3.select(t+" div.legend"),s=d3.select(t+" svg g[data-g=one]"),u=(d3.select(t+" svg g[data-g=one] path"),d3.select(t+" svg g.x-axis")),v=(d3.select(t+" svg g.x-axis text"),d3.select(t+" svg g.y-axis"));d3.select(t+" svg g.y-axis text")}switch(e.xtype.toLowerCase()){case"num":var g=d3.scale.linear().range([0,n]);break;default:var g=d3.time.scale().range([0,n])}var h=d3.scale.linear().range([l,0]),p=d3.svg.axis().scale(g).orient("bottom").ticks(5).outerTickSize(0);void 0!=e.xformat&&p.tickFormat(d3.format(e.xformat));var f=d3.svg.axis().scale(h).orient("left").ticks(5).outerTickSize(0);return void 0!=e.yformat&&f.tickFormat(d3.format(e.yformat)),void 0!=e.csv?(void 0!=e.debug&&console.log("loading csv"),d3.csv(e.csv,a)):void 0!=e.tsv?(void 0!=e.debug&&console.log("loading tsv"),d3.tsv(e.tsv,a)):void 0!=e.json?(void 0!=e.debug&&console.log("loading json"),d3.json(e.json,a)):void 0!=e.data?(void 0!=e.debug&&console.log("loading data"),a(e.data)):(void 0!=e.debug&&console.log("loading random data"),a(wd3RandomLineData())),!1}function wd3MapChart(t,e){if(void 0==d3)return alert("d3 library is not loaded"),!1;void 0==t&&(t="body");var a=document.querySelector(t);if(void 0==a)return void console.log("wd3MapChart Error: undefined parent");void 0==e&&(e={}),void 0==e.width&&(e.width=getWidth(a)),void 0==e.height&&(e.height=getHeight(a)),void 0!=e.debug&&console.log(e),e.height<20&&(e.height=250),e.width<20&&(e.width=350);var i={"1st":"#3399ff","2nd":"#805393","3rd":"#9c71ae","4th":"#ae8cbd","5th":"#c8afd2","6th":"#d9c8e0",defaultFill:"#e5e5e5"};if(void 0==document.querySelector(t+" .datamap")){var r={width:e.width,height:e.height,scope:"usa","class":"haha",fills:i,element:document.querySelector(t),data:{},legend:!1,labels:!0,id:"map",geographyConfig:{popupTemplate:function(t,e){return"<div class=hoverinfo><strong>"+t.properties.name+": "+wd3NumberWithCommas(e.value)+"</strong></div>"}}};wd3MapChartMaps[t]=new Datamap(r),r.legend&&wd3MapChartMaps[t].legend(),r.labels&&wd3MapChartMaps[t].labels(),void 0!=e.onclick&&d3.selectAll(t+" .datamaps-subunit").on("click",function(t){if(void 0==window[e.onclick])return console.log('wd3MapChart onclick error: "'+e.onclick+'" is not a valid function'),!1;var a=new Array;a.push(d3.select(this).attr("data-label")),a.push(d3.select(this).attr("data-value")),window[e.onclick].apply(this,a)}),d3.select(t).append("div").attr("class","legend").text(""),d3.select(t+" .legend").append("span").text("Most");for(var o in i)d3.select(t+" .legend").append("span").attr("class","icon-blank").attr("style","color:"+i[o]);d3.select(t+" .legend").append("span").text("Least")}return void 0!=e.csv?(void 0!=e.debug&&console.log("loading csv"),d3.csv(e.csv,function(a,i){for(var r=i,o=0;o<i.length;o++)r[r[o].id]=r[o],delete r[o].id,delete r[o];if(wd3MapChartMaps[t].updateChoropleth(r),void 0!=e.onclick)for(var n in r)d3.select(t+" .datamaps-subunit."+n).attr("data-value",+r[n].value).attr("data-label",+n)})):void 0!=e.tsv?(void 0!=e.debug&&console.log("loading tsv"),d3.tsv(e.tsv,function(a,i){for(var r=i,o=0;o<i.length;o++)r[r[o].id]=r[o],delete r[o].id,delete r[o];if(wd3MapChartMaps[t].updateChoropleth(r),void 0!=e.onclick)for(var n in r)d3.select(t+" .datamaps-subunit."+n).attr("data-value",+r[n].value).attr("data-label",+n)})):void 0!=e.json?(void 0!=e.debug&&console.log("loading json"),d3.json(e.json,function(a,i){for(var r=i,o=0;o<i.length;o++)r[r[o].id]=r[o],delete r[o].id,delete r[o];if(wd3MapChartMaps[t].updateChoropleth(r),void 0!=e.onclick)for(var n in r)d3.select(t+" .datamaps-subunit."+n).attr("data-value",+r[n].value).attr("data-label",+n)})):void 0!=e.data&&(void 0!=e.debug&&console.log("loading data"),wd3MapChartMaps[t].updateChoropleth(e.data)),!1}function wd3NumberWithCommas(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function wd3BarChart(t,e){function a(t){t.forEach(function(t){t.value=+t.value,void 0!=e.rightvalue&&(t.linevalue=+t[e.rightvalue])}),o.domain(t.map(function(t){return t.label})),n.domain([0,d3.max(t,function(t){return t.value})]),void 0!=e.rightvalue&&u.domain([0,d3.max(t,function(t){return t.linevalue})]),g.select(".x.axis").transition().duration(300).call(l).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start"),g.select(".y.axis").transition().duration(300).call(d),void 0!=e.rightvalue&&g.select(".y.axisline").transition().duration(300).call(v);var a=g.selectAll("rect").data(t,function(t){return t.label});if(a.exit().transition().duration(300).attr("y",n(0)).attr("height",e.height-n(0)).style("fill-opacity",1e-6).remove(),a.enter().append("rect").attr("fill",r.range()[0]).attr("y",n(0)).attr("height",e.height-n(0)).attr("data-value",function(t){return t.value}).attr("data-label",function(t){return t.label}).on("mouseover",function(){var t=d3.select(this).style("fill");d3.select(this).attr("fill_ori",t),d3.select(this).style("fill",d3.rgb(t).darker(.3))}).on("mouseout",function(){var t=d3.select(this).attr("fill_ori");d3.select(this).style("fill",t)}).on("click",function(){if(void 0==e.onclick)return!1;if(void 0==window[e.onclick])return console.log('wd3MapChart onclick error: "'+e.onclick+'" is not a valid function'),!1;var t=new Array;t.push(d3.select(this).attr("data-label")),t.push(d3.select(this).attr("data-value")),window[e.onclick].apply(this,t)}),a.transition().duration(300).attr("x",function(t){return o(t.label)}).attr("width",o.rangeBand()).attr("y",function(t){return n(t.value)}).attr("height",function(t){return e.height-n(t.value)}),void 0!=e.rightvalue){var i=g.selectAll("path.line").data(t,function(t){return t.label});i.exit().transition().duration(300).remove(),i.enter().append("path").attr("class","line").style("fill","none").style("stroke",s).style("stroke-width","3").style("z-index","999").attr("d",c(t)),i.transition().duration(300).attr("d",c(t))}}if(void 0==d3)return alert("d3 library is not loaded"),!1;void 0==t&&(t="body");var i=document.querySelector(t);if(void 0==i)return void console.log("wd3BarChart Error: undefined parent");void 0==e&&(e={}),void 0==e.width&&(e.width=getWidth(i)),void 0==e.height&&(e.height=getHeight(i)),void 0==e.top&&(e.top=30),void 0==e.right&&(e.right=55),void 0==e.bottom&&(e.bottom=50),void 0==e.left&&(e.left=80),void 0==e.padding&&(e.padding=1),void 0==e.yticks&&(e.yticks=10),void 0==e.label&&(e.label="label"),void 0==e.duration&&(e.duration=300),void 0!=e.debug&&console.log(e),void 0==e.ylabel&&(e.ylabel=""),void 0==e.xlabel&&(e.xlabel=""),void 0==e.ylabeloffset&&(e.ylabeloffset=-50),void 0==e.rightlabel&&(e.rightlabel=""),e.height<20&&(e.height=300),e.width<20&&(e.width=300),e.width=e.width-e.left-e.right,e.height=e.height-e.top-e.bottom;var r=d3.scale.category20(),o=d3.scale.ordinal().rangeRoundBands([0,e.width],.1),n=d3.scale.linear().range([e.height,0]),l=d3.svg.axis().scale(o).orient("bottom").ticks(e.xticks);void 0!=e.xformat&&l.tickFormat(d3.format(e.xformat));var d=d3.svg.axis().scale(n).orient("left").ticks(e.yticks);if(void 0!=e.yformat&&d.tickFormat(d3.format(e.yformat)),void 0!=e.rightvalue){var s=r.range()[2],c=d3.svg.line().x(function(t){return o(t.label)+10}).y(function(t){return u(t.linevalue)}),u=d3.scale.linear().range([e.height,0]);void 0==e.rightticks&&(e.rightticks=10);var v=d3.svg.axis().scale(u).orient("right").ticks(e.rightticks);void 0!=e.rightformat&&v.tickFormat(d3.format(e.rightformat))}if(void 0==document.querySelector(t+" svg")){void 0!=e.debug&&console.log("new bar chart - adding svg"),d3.select(t).append("div").attr("class","title text-center").text("");var g=d3.select(t).append("svg").attr("width",e.width+e.left+e.right).attr("height",e.height+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");g.append("g").attr("class","x axis").attr("transform","translate(0,"+e.height+")"),g.append("g").attr("class","y axis").append("text").attr("text-anchor","middle").attr("transform","translate("+e.padding+","+e.height/2+")rotate(-90)").attr("y",e.ylabeloffset).attr("dy",".71em").style("text-anchor","end").text(e.ylabel),void 0!=e.rightvalue&&(void 0==e.rightlabel&&(e.rightlabel=""),g.append("g").attr("class","y axisline").attr("transform","translate("+e.width+" ,0)").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","start").text(e.rightlabel))}else{void 0!=e.debug&&console.log("existing chart - updating");var g=d3.select(t+" svg")}return void 0!=e.csv?(void 0!=e.debug&&console.log("loading csv"),d3.csv(e.csv,a)):void 0!=e.tsv?(void 0!=e.debug&&console.log("loading tsv"),d3.tsv(e.tsv,a)):void 0!=e.json?(void 0!=e.debug&&console.log("loading json"),d3.json(e.json,a)):void 0!=e.data&&(void 0!=e.debug&&console.log("loading data"),a(e.data)),!1}function wd3PieChart(t,e){function a(a){function i(t){return t.startAngle+(t.endAngle-t.startAngle)/2}a.forEach(function(t){t.value=+t.value});var u=d3.sum(a,function(t){return t.value});a.forEach(function(t){t.percent=Math.round(t.value/u*100,1)});var v=o.select(".slices").selectAll("path.slice").data(c(a),s);if(v.enter().insert("path").style("fill",function(t,a){return void 0!=e.debug&&console.log("new slice:i="+a+",color="+r.range()[a]+", label="+t.data.label),r.range()[a]}).style("stroke","#FFF").style("stroke-width","1px").attr("class","slice"),v.attr("data-percent",function(t){return t.data.percent}),v.attr("data-value",function(t){return t.data.value}),v.attr("data-label",function(t){return t.data.label}),v.attr("id",function(t,e){return"slice"+e}),v.on("mouseover",function(){var e=d3.select(this).style("fill");d3.select(this).attr("fill_ori",e),d3.select(this).style("fill",d3.rgb(e).darker(.3)),d3.select(t+" .title").text(d3.select(this).attr("data-percent")+"%")}),v.on("mouseout",function(){var e=d3.select(this).attr("fill_ori");d3.select(this).style("fill",e),d3.select(t+" .title").text("")}),void 0!=e.onclick&&v.on("click",function(){if(void 0==window[e.onclick])return console.log('wd3MapChart onclick error: "'+e.onclick+'" is not a valid function'),!1;var t=new Array;t.push(d3.select(this).attr("data-label")),t.push(d3.select(this).attr("data-value")),t.push(d3.select(this).attr("data-percent")),window[e.onclick].apply(this,t)}),v.transition().duration(1e3).attrTween("d",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return l(e(t))}}),v.exit().remove(),1==e.labels){var g=o.select(".labels").selectAll("text").data(c(a),s);g.enter().append("text").attr("dy",".35em").text(function(t){return t.data.label}),g.transition().duration(1e3).attrTween("transform",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var a=e(t),r=d.centroid(a);return i(a)<Math.PI?r[0]=n-12:r[0]=-1*n+12,"translate("+r+")"}}).styleTween("text-anchor",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var a=e(t);return i(a)<Math.PI?"start":"end"}}),g.exit().remove();var h=o.select(".lines").selectAll("polyline").data(c(a),s);h.enter().append("polyline"),h.transition().duration(1e3).attrTween("points",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var a=e(t),r=d.centroid(a);return r[0]=.91*n*(i(a)<Math.PI?1:-1),[l.centroid(a),d.centroid(a),r]}}),h.exit().remove()}if(1==e.legend){var p=d3.select(t+" div.legend").selectAll("span.item").data(c(a),s).enter().append("span").attr("class","item").style("min-width","150px").attr("data-percent",function(t){return t.data.percent}).attr("data-value",function(t){return t.data.value}).attr("data-label",function(t){return t.data.label}).attr("data-color",function(t,e){return r.range()[e]}).attr("data-id",function(t,e){return"slice"+e});void 0!=e.legend_block&&p.style("display","block"),p.append("span").attr("class","icon-blank w_big").style("margin-left","3px").style("color",function(t,e){return r.range()[e]}),p.insert("span").text(function(t){return" "+t.data.label}),p.on("mouseover",function(){var a=d3.rgb(this.getAttribute("data-color")).darker(.3);d3.select(t+" .title").text(d3.select(this).attr("data-percent")+"%"),this.style.color=a,void 0!=e.onclick&&(this.style.cursor="pointer")}),p.on("mouseout",function(){d3.select(t+" .title").text(""),this.style.color=""}),void 0!=e.onclick&&p.on("click",function(){if(void 0==window[e.onclick])return console.log('wd3MapChart onclick error: "'+e.onclick+'" is not a valid function'),!1;var t=new Array;t.push(d3.select(this).attr("data-label")),t.push(d3.select(this).attr("data-value")),t.push(d3.select(this).attr("data-percent")),window[e.onclick].apply(this,t)}),d3.select(t+" div.legend").selectAll("span.item").data(c(a),s).exit().remove()}}if(void 0==d3)return alert("d3 library is not loaded"),!1;void 0==t&&(t="body");var i=document.querySelector(t);if(void 0==i)return void console.log("wd3PieChart Error: undefined parent");void 0==e&&(e={}),void 0==e.width&&(e.width=getWidth(i)),void 0==e.height&&(e.height=getHeight(i)),void 0==e.padding&&(e.padding=20),void 0==e.labels&&(e.labels=1),void 0==e.legend&&(e.legend=1),void 0!=e.debug&&console.log(e),e.height<20&&(e.height=300),e.width<20&&(e.width=300);var r=d3.scale.category20();if(void 0==document.querySelector(t+" svg")){void 0!=e.debug&&console.log("new chart - adding svg");var o=d3.select(t).append("svg").attr("width",e.width).attr("height",e.height).append("g");void 0!=e.type&&"donut"==e.type?o.append("text").attr("class","title").attr("text-anchor","middle").attr("transform","translate(0,4)").text(""):d3.select(t).append("div").attr("class","title text-center").text(""),o.append("g").attr("class","slices"),1==e.labels&&(o.append("g").attr("class","labels"),o.append("g").attr("class","lines")),1==e.legend&&d3.select(t).append("div").attr("class","legend").text(""),o.attr("transform","translate("+e.width/2+","+e.height/2+")")}else{void 0!=e.debug&&console.log("existing chart - updating");var o=d3.select(t+" svg")}var n=Math.round(Math.min(e.width,e.height)/2)-e.padding;if(void 0!=e.type&&"donut"==e.type){void 0==e.donut&&(e.donut=.4);var l=d3.svg.arc().outerRadius(.8*n).innerRadius(n*e.donut)}else var l=d3.svg.arc().outerRadius(.85*n).innerRadius(0);if(1==e.labels)var d=d3.svg.arc().innerRadius(.9*n).outerRadius(.9*n);var s=function(t){return t.data.label},c=d3.layout.pie().value(function(t){return t.value}).sort(null);return void 0!=e.csv?(void 0!=e.debug&&console.log("loading csv"),d3.csv(e.csv,a)):void 0!=e.tsv?(void 0!=e.debug&&console.log("loading tsv"),d3.tsv(e.tsv,a)):void 0!=e.json?(void 0!=e.debug&&console.log("loading json"),d3.json(e.json,a)):void 0!=e.data?(void 0!=e.debug&&console.log("loading data"),a(e.data)):(void 0!=e.debug&&console.log("loading random data"),a(wd3RandomPieData())),!1}function wd3RandomPieData(){var t=d3.scale.ordinal().domain(["Lorem ipsum","dolor sit","amet","consectetur","adipisicing","eiusmod","tempor","incididunt"]),e=t.domain();return e.map(function(t){return{label:t,value:Math.random()}})}var wd3MapChartMaps=new Array;