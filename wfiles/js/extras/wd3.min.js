function wd3LineChart(t,e){function a(t){for(var a=Object.keys(t[0]),i=new Array,n={},o=0;o<a.length;o++){a[o];a[o]!=e.label&&(i.push(a[o]),n[a[o]]=a[o].replace(" ",""))}t.forEach(function(t){switch(e.xtype.toLowerCase()){case"num":t[e.label]=+t[e.label];break;case"date":t[e.label]=new Date(t[e.label])}for(var a=0;a<i.length;a++){var r=i[a];t[r]=+t[r]}}),void 0!=e.debug&&(console.log("data:",t),console.log("keys:",a),console.log("ykeys:",i),console.log("label:",e.label));for(var d={},o=0;o<i.length;o++){var l=i[o];d[l]=d3.svg.line().interpolate("basis").x(function(t){return g(t[e.label])}).y(function(t){return h(+t[l])})}void 0!=e.debug&&console.log("lines: ",d),g.domain(d3.extent(t,function(t){return t[e.label]})),h.domain([d3.min(t,function(t){for(var e=new Array,a=0;a<i.length;a++){var r=i[a];e.push(+t[r])}return Math.min.apply(null,e)})+-1,d3.max(t,function(t){for(var e=new Array,a=0;a<i.length;a++){var r=i[a];e.push(+t[r])}return Math.max.apply(null,e)})+1]),v.call(p),u.call(f);var m=s.selectAll("path.line")[0];void 0!=e.debug&&console.log("plines: ",m),c.selectAll("span").remove();for(var o=0;o<i.length;o++){var l=i[o],b=c.append("span");b.append("span").attr("class","icon-blank").style("color",r.range()[o]),b.append("span").text(" "+l+" ");var y=s.selectAll("path.line."+n[l]);void 0!=e.debug&&console.log("linegraph: ",y);for(var x=0;x<m.length;x++)if(void 0!=m[x].getAttribute("class")){var w=m[x].getAttribute("class");if(void 0!=w){var k=w.indexOf(n[l]);-1!=k&&m.splice(x,1)}}y.empty()&&(y=s.append("path").attr("class","line "+n[l]).style("stroke",r.range()[o]).style("fill","none").style("stroke-width","2px")),y.transition().ease("linear").duration(500).style("stroke",r.range()[o]).attr("d",d[l](t))}void 0!=e.debug&&console.log("remove plines: ",m);for(var x=0;x<m.length;x++)m[x].remove();e={},d={}}void 0==t&&(t="body");var i=document.querySelector(t);if(void 0==i)return void console.log("wd3LineChart Error: undefined parent");void 0==e&&(e={}),void 0==e.top&&(e.top=20),void 0==e.right&&(e.right=20),void 0==e.bottom&&(e.bottom=30),void 0==e.left&&(e.left=50),void 0==e.width&&(e.width=getWidth(i)-e.left-e.right),void 0==e.height&&(e.height=getHeight(i)-e.top-e.bottom),void 0==e.padding&&(e.padding=1),void 0==e.yticks&&(e.yticks=Math.round(e.height/30)),void 0==e.xticks&&(e.xticks=Math.round(e.width/30)),void 0==e.xtype&&(e.xtype="date"),void 0==e.label&&(e.label="label"),void 0==e.duration&&(e.padding=10),e.height<20&&(e.height=300),e.width<20&&(e.width=300),void 0!=e.debug&&console.log("Params:",e);var r=d3.scale.category20(),n=40,o=e.width-e.left-e.right,d=e.height-e.top-e.bottom;if(void 0!=e.debug&&console.log("innerWidth:",o),void 0!=e.debug&&console.log("innerHeight:",d),void 0==document.querySelector(t+" svg")){var l=d3.select(t).append("svg").attr("width",e.width).attr("height",e.height),s=l.append("g").attr("transform","translate("+e.left+","+e.top+")").attr("data-g","one"),c=d3.select(t).append("div").attr("class","legend").style("margin-left",e.left+"px").style("margin-right",e.right+"px"),v=s.append("g").style("stroke","grey").style("fill","none").style("stroke-width","1px").attr("class","x-axis").attr("transform","translate(0,"+d+")"),u=s.append("g").attr("class","y-axis").style("stroke","grey").style("fill","none").style("stroke-width","1px");u.append("text").style("text-anchor","middle").attr("transform","translate(-"+n+","+d/2+") rotate(-90)").attr("class","label")}else{var l=d3.select(t+" svg"),c=d3.select(t+" div.legend"),s=d3.select(t+" svg g[data-g=one]"),v=(d3.select(t+" svg g[data-g=one] path"),d3.select(t+" svg g.x-axis")),u=(d3.select(t+" svg g.x-axis text"),d3.select(t+" svg g.y-axis"));d3.select(t+" svg g.y-axis text")}switch(e.xtype.toLowerCase()){case"num":var g=d3.scale.linear().range([0,o]);break;default:var g=d3.time.scale().range([0,o])}var h=d3.scale.linear().range([d,0]),p=d3.svg.axis().scale(g).orient("bottom").ticks(5).outerTickSize(0);void 0!=e.xformat&&p.tickFormat(d3.format(e.xformat));var f=d3.svg.axis().scale(h).orient("left").ticks(5).outerTickSize(0);return void 0!=e.yformat&&f.tickFormat(d3.format(e.yformat)),void 0!=e.csv?(void 0!=e.debug&&console.log("loading csv"),d3.csv(e.csv,a)):void 0!=e.tsv?(void 0!=e.debug&&console.log("loading tsv"),d3.tsv(e.tsv,a)):void 0!=e.json?(void 0!=e.debug&&console.log("loading json"),d3.json(e.json,a)):void 0!=e.data?(void 0!=e.debug&&console.log("loading data"),a(e.data)):(void 0!=e.debug&&console.log("loading random data"),a(wd3RandomLineData())),!1}function wd3MapChart(t,e){if(void 0==d3)return alert("d3 library is not loaded"),!1;void 0==t&&(t="body");var a=document.querySelector(t);if(void 0==a)return void console.log("wd3MapChart Error: undefined parent");void 0==e&&(e={}),void 0==e.width&&(e.width=getWidth(a)),void 0==e.height&&(e.height=getHeight(a)),void 0!=e.debug&&console.log(e),e.height<20&&(e.height=250),e.width<20&&(e.width=350);var i={"1st":"#3399ff","2nd":"#805393","3rd":"#9c71ae","4th":"#ae8cbd","5th":"#c8afd2","6th":"#d9c8e0",defaultFill:"#e5e5e5"};if(void 0==document.querySelector(t+" .datamap")){var r={width:e.width,height:e.height,scope:"usa","class":"haha",fills:i,element:document.querySelector(t),data:{},legend:!1,labels:!0,id:"map",geographyConfig:{popupTemplate:function(t,e){return"<div class=hoverinfo><strong>"+t.properties.name+": "+wd3NumberWithCommas(e.value)+"</strong></div>"}}};wd3MapChartMaps[t]=new Datamap(r),r.legend&&wd3MapChartMaps[t].legend(),r.labels&&wd3MapChartMaps[t].labels(),void 0!=e.onclick&&d3.selectAll(t+" .datamaps-subunit").on("click",function(t){var a=new Array;a.push(d3.select(this).attr("data-label")),a.push(d3.select(this).attr("data-value")),window[e.onclick].apply(this,a)}),d3.select(t).append("div").attr("class","legend").text(""),d3.select(t+" .legend").append("span").text("Most");for(var n in i)d3.select(t+" .legend").append("span").attr("class","icon-blank").attr("style","color:"+i[n]);d3.select(t+" .legend").append("span").text("Least")}return void 0!=e.csv?(void 0!=e.debug&&console.log("loading csv"),d3.csv(e.csv,function(a,i){for(var r=i,n=0;n<i.length;n++)r[r[n].id]=r[n],delete r[n].id,delete r[n];if(wd3MapChartMaps[t].updateChoropleth(r),void 0!=e.onclick)for(var o in r)d3.select(t+" .datamaps-subunit."+o).attr("data-value",+r[o].value).attr("data-label",+o)})):void 0!=e.tsv?(void 0!=e.debug&&console.log("loading tsv"),d3.tsv(e.tsv,function(a,i){for(var r=i,n=0;n<i.length;n++)r[r[n].id]=r[n],delete r[n].id,delete r[n];if(wd3MapChartMaps[t].updateChoropleth(r),void 0!=e.onclick)for(var o in r)d3.select(t+" .datamaps-subunit."+o).attr("data-value",+r[o].value).attr("data-label",+o)})):void 0!=e.json?(void 0!=e.debug&&console.log("loading json"),d3.json(e.json,function(a,i){for(var r=i,n=0;n<i.length;n++)r[r[n].id]=r[n],delete r[n].id,delete r[n];if(wd3MapChartMaps[t].updateChoropleth(r),void 0!=e.onclick)for(var o in r)d3.select(t+" .datamaps-subunit."+o).attr("data-value",+r[o].value).attr("data-label",+o)})):void 0!=e.data&&(void 0!=e.debug&&console.log("loading data"),wd3MapChartMaps[t].updateChoropleth(e.data)),!1}function wd3NumberWithCommas(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function wd3BarChart(t,e){function a(t){t.forEach(function(t){t.value=+t.value,void 0!=e.rightvalue&&(t.linevalue=+t[e.rightvalue])}),n.domain(t.map(function(t){return t.label})),o.domain([0,d3.max(t,function(t){return t.value})]),void 0!=e.rightvalue&&v.domain([0,d3.max(t,function(t){return t.linevalue})]),g.select(".x.axis").transition().duration(300).call(d).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start"),g.select(".y.axis").transition().duration(300).call(l),void 0!=e.rightvalue&&g.select(".y.axisline").transition().duration(300).call(u);var a=g.selectAll("rect").data(t,function(t){return t.label});if(a.exit().transition().duration(300).attr("y",o(0)).attr("height",e.height-o(0)).style("fill-opacity",1e-6).remove(),a.enter().append("rect").attr("fill",r.range()[0]).attr("y",o(0)).attr("height",e.height-o(0)).attr("data-value",function(t){return t.value}).attr("data-label",function(t){return t.label}).on("mouseover",function(){var t=d3.select(this).style("fill");d3.select(this).attr("fill_ori",t),d3.select(this).style("fill",d3.rgb(t).darker(.3))}).on("mouseout",function(){var t=d3.select(this).attr("fill_ori");d3.select(this).style("fill",t)}).on("click",function(){if(void 0!=e.onclick){var t=new Array;t.push(d3.select(this).attr("data-label")),t.push(d3.select(this).attr("data-value")),window[e.onclick].apply(this,t)}}),a.transition().duration(300).attr("x",function(t){return n(t.label)}).attr("width",n.rangeBand()).attr("y",function(t){return o(t.value)}).attr("height",function(t){return e.height-o(t.value)}),void 0!=e.rightvalue){var i=g.selectAll("path.line").data(t,function(t){return t.label});i.exit().transition().duration(300).remove(),i.enter().append("path").attr("class","line").style("fill","none").style("stroke",s).style("stroke-width","3").style("z-index","999").attr("d",c(t)),i.transition().duration(300).attr("d",c(t))}}if(void 0==d3)return alert("d3 library is not loaded"),!1;void 0==t&&(t="body");var i=document.querySelector(t);if(void 0==i)return void console.log("wd3BarChart Error: undefined parent");void 0==e&&(e={}),void 0==e.width&&(e.width=getWidth(i)),void 0==e.height&&(e.height=getHeight(i)),void 0==e.top&&(e.top=30),void 0==e.right&&(e.right=55),void 0==e.bottom&&(e.bottom=50),void 0==e.left&&(e.left=80),void 0==e.padding&&(e.padding=1),void 0==e.yticks&&(e.yticks=10),void 0==e.label&&(e.label="label"),void 0==e.duration&&(e.duration=300),void 0!=e.debug&&console.log(e),e.height<20&&(e.height=300),e.width<20&&(e.width=300),e.width=e.width-e.left-e.right,e.height=e.height-e.top-e.bottom;var r=d3.scale.category20(),n=d3.scale.ordinal().rangeRoundBands([0,e.width],.1),o=d3.scale.linear().range([e.height,0]),d=d3.svg.axis().scale(n).orient("bottom").ticks(e.xticks);void 0!=e.xformat&&d.tickFormat(d3.format(e.xformat));var l=d3.svg.axis().scale(o).orient("left").ticks(e.yticks);if(void 0!=e.yformat&&l.tickFormat(d3.format(e.yformat)),void 0!=e.rightvalue){var s=r.range()[2],c=d3.svg.line().x(function(t){return n(t.label)+10}).y(function(t){return v(t.linevalue)}),v=d3.scale.linear().range([e.height,0]);void 0==e.rightticks&&(e.rightticks=10);var u=d3.svg.axis().scale(v).orient("right").ticks(e.rightticks);void 0!=e.rightformat&&u.tickFormat(d3.format(e.rightformat))}if(void 0==document.querySelector(t+" svg")){void 0!=e.debug&&console.log("new bar chart - adding svg"),d3.select(t).append("div").attr("class","title text-center").text("");var g=d3.select(t).append("svg").attr("width",e.width+e.left+e.right).attr("height",e.height+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");g.append("g").attr("class","x axis").attr("transform","translate(0,"+e.height+")"),g.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end"),void 0!=e.rightvalue&&g.append("g").attr("class","y axisline").attr("transform","translate("+e.width+" ,0)").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","start")}else{void 0!=e.debug&&console.log("existing chart - updating");var g=d3.select(t+" svg")}return void 0!=e.csv?(void 0!=e.debug&&console.log("loading csv"),d3.csv(e.csv,a)):void 0!=e.tsv?(void 0!=e.debug&&console.log("loading tsv"),d3.tsv(e.tsv,a)):void 0!=e.json?(void 0!=e.debug&&console.log("loading json"),d3.json(e.json,a)):void 0!=e.data&&(void 0!=e.debug&&console.log("loading data"),a(e.data)),!1}function wd3PieChart(t,e){function a(a){function i(t){return t.startAngle+(t.endAngle-t.startAngle)/2}a.forEach(function(t){t.value=+t.value});var v=d3.sum(a,function(t){return t.value});a.forEach(function(t){t.percent=Math.round(t.value/v*100,1)});var u=n.select(".slices").selectAll("path.slice").data(c(a),s);if(u.enter().insert("path").style("fill",function(t,a){return void 0!=e.debug&&console.log("new slice:i="+a+",color="+r.range()[a]+", label="+t.data.label),r.range()[a]}).style("stroke","#FFF").style("stroke-width","1px").attr("class","slice"),u.attr("data-percent",function(t){return t.data.percent}),u.attr("data-value",function(t){return t.data.value}),u.attr("data-label",function(t){return t.data.label}),u.on("mouseover",function(){var e=d3.select(this).style("fill");d3.select(this).attr("fill_ori",e),d3.select(this).style("fill",d3.rgb(e).darker(.3)),d3.select(t+" .title").text(d3.select(this).attr("data-percent")+"%")}),u.on("mouseout",function(){var e=d3.select(this).attr("fill_ori");d3.select(this).style("fill",e),d3.select(t+" .title").text("")}),void 0!=e.onclick&&u.on("click",function(){var t=new Array;t.push(d3.select(this).attr("data-label")),t.push(d3.select(this).attr("data-value")),t.push(d3.select(this).attr("data-percent")),window[e.onclick].apply(this,t)}),u.transition().duration(1e3).attrTween("d",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return d(e(t))}}),u.exit().remove(),1==e.labels){var g=n.select(".labels").selectAll("text").data(c(a),s);g.enter().append("text").attr("dy",".35em").text(function(t){return t.data.label}),g.transition().duration(1e3).attrTween("transform",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var a=e(t),r=l.centroid(a);return i(a)<Math.PI?r[0]=o-12:r[0]=-1*o+12,"translate("+r+")"}}).styleTween("text-anchor",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var a=e(t);return i(a)<Math.PI?"start":"end"}}),g.exit().remove();var h=n.select(".lines").selectAll("polyline").data(c(a),s);h.enter().append("polyline"),h.transition().duration(1e3).attrTween("points",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var a=e(t),r=l.centroid(a);return r[0]=.91*o*(i(a)<Math.PI?1:-1),[d.centroid(a),l.centroid(a),r]}}),h.exit().remove()}if(1==e.legend){var p=d3.select(t+" div.legend").selectAll("span.item").data(c(a),s).enter().append("span").attr("class","item").style("min-width","150px").attr("data-percent",function(t){return t.data.percent}).attr("data-value",function(t){return t.data.value}).attr("data-label",function(t){return t.data.label});p.append("span").attr("class","icon-blank").style("margin-left","3px").style("color",function(t,e){return r.range()[e]}),p.insert("span").text(function(t){return" "+t.data.label}),p.on("mouseover",function(){d3.select(t+" .title").text(d3.select(this).attr("data-percent")+"%")}),p.on("mouseout",function(){d3.select(t+" .title").text("")}),d3.select(t+" div.legend").selectAll("span.item").data(c(a),s).exit().remove()}}if(void 0==d3)return alert("d3 library is not loaded"),!1;void 0==t&&(t="body");var i=document.querySelector(t);if(void 0==i)return void console.log("wd3PieChart Error: undefined parent");void 0==e&&(e={}),void 0==e.width&&(e.width=getWidth(i)),void 0==e.height&&(e.height=getHeight(i)),void 0==e.padding&&(e.padding=20),void 0==e.labels&&(e.labels=1),void 0==e.legend&&(e.legend=1),void 0!=e.debug&&console.log(e),e.height<20&&(e.height=300),e.width<20&&(e.width=300);var r=d3.scale.category20();if(void 0==document.querySelector(t+" svg")){void 0!=e.debug&&console.log("new chart - adding svg");var n=d3.select(t).append("svg").attr("width",e.width).attr("height",e.height).append("g");void 0!=e.type&&"donut"==e.type?n.append("text").attr("class","title").attr("text-anchor","middle").attr("transform","translate(0,4)").text(""):d3.select(t).append("div").attr("class","title text-center").text(""),n.append("g").attr("class","slices"),1==e.labels&&(n.append("g").attr("class","labels"),n.append("g").attr("class","lines")),1==e.legend&&d3.select(t).append("div").attr("class","legend").text(""),n.attr("transform","translate("+e.width/2+","+e.height/2+")")}else{void 0!=e.debug&&console.log("existing chart - updating");var n=d3.select(t+" svg")}var o=Math.round(Math.min(e.width,e.height)/2)-e.padding;if(void 0!=e.type&&"donut"==e.type){void 0==e.donut&&(e.donut=.4);var d=d3.svg.arc().outerRadius(.8*o).innerRadius(o*e.donut)}else var d=d3.svg.arc().outerRadius(.85*o).innerRadius(0);if(1==e.labels)var l=d3.svg.arc().innerRadius(.9*o).outerRadius(.9*o);var s=function(t){return t.data.label},c=d3.layout.pie().value(function(t){return t.value}).sort(null);return void 0!=e.csv?(void 0!=e.debug&&console.log("loading csv"),d3.csv(e.csv,a)):void 0!=e.tsv?(void 0!=e.debug&&console.log("loading tsv"),d3.tsv(e.tsv,a)):void 0!=e.json?(void 0!=e.debug&&console.log("loading json"),d3.json(e.json,a)):void 0!=e.data?(void 0!=e.debug&&console.log("loading data"),a(e.data)):(void 0!=e.debug&&console.log("loading random data"),a(wd3RandomPieData())),!1}function wd3RandomPieData(){var t=d3.scale.ordinal().domain(["Lorem ipsum","dolor sit","amet","consectetur","adipisicing","eiusmod","tempor","incididunt"]),e=t.domain();return e.map(function(t){return{label:t,value:Math.random()}})}var wd3MapChartMaps=new Array;