function wd3PieChart(t,e){function n(n){function r(t){return t.startAngle+(t.endAngle-t.startAngle)/2}n.forEach(function(t){t.value=+t.value});var u=d3.sum(n,function(t){return t.value});n.forEach(function(t){t.percent=Math.round(t.value/u*100,1)});var v=i.select(".slices").selectAll("path.slice").data(c(n),s);v.enter().insert("path").style("fill",function(t,n){return void 0!=e.debug&&console.log("new slice:i="+n+",color="+a(n)+", label="+t.data.label),a(n)}).attr("class","slice"),v.attr("data-percent",function(t){return t.data.percent}),v.attr("data-value",function(t){return t.data.value}),v.attr("data-label",function(t){return t.data.label}),v.on("mouseover",function(){var e=d3.select(this).style("fill");d3.select(this).attr("fill_ori",e),d3.select(this).style("fill",d3.rgb(e).darker(.3)),d3.select(t+" .title").text(d3.select(this).attr("data-percent")+"%")}),v.on("mouseout",function(){var e=d3.select(this).attr("fill_ori");d3.select(this).style("fill",e),d3.select(t+" .title").text("")}),void 0!=e.onclick&&v.on("click",function(){var t=new Array;t.push(d3.select(this).attr("data-label")),t.push(d3.select(this).attr("data-value")),t.push(d3.select(this).attr("data-percent")),window[e.onclick].apply(this,t)}),v.transition().duration(1e3).attrTween("d",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return o(e(t))}}),v.exit().remove();var h=i.select(".labels").selectAll("text").data(c(n),s);h.enter().append("text").attr("dy",".35em").text(function(t){return t.data.label}),h.transition().duration(1e3).attrTween("transform",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var n=e(t),a=l.centroid(n);return r(n)<Math.PI?a[0]=d-12:a[0]=-1*d+12,"translate("+a+")"}}).styleTween("text-anchor",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var n=e(t);return r(n)<Math.PI?"start":"end"}}),h.exit().remove();var g=i.select(".lines").selectAll("polyline").data(c(n),s);g.enter().append("polyline"),g.transition().duration(1e3).attrTween("points",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var n=e(t),a=l.centroid(n);return a[0]=.91*d*(r(n)<Math.PI?1:-1),[o.centroid(n),l.centroid(n),a]}}),g.exit().remove()}if(void 0==d3)return alert("d3 library is not loaded"),!1;void 0==t&&(t="body");var r=document.querySelector(t);if(void 0==r)return void console.log("wd3PieChart Error: undefined parent");void 0==e&&(e={}),void 0==e.width&&(e.width=getWidth(r)),void 0==e.height&&(e.height=getHeight(r)),void 0==e.padding&&(e.padding=60),void 0!=e.debug&&console.log(e),e.height<20&&(e.height=300),e.width<20&&(e.width=300);var a=d3.scale.category20();if(void 0==document.querySelector(t+" svg")){void 0!=e.debug&&console.log("new chart - adding svg");var i=d3.select(t).append("svg").attr("width",e.width).attr("height",e.height).append("g");void 0!=e.type&&"donut"==e.type?i.append("text").attr("class","title").attr("text-anchor","middle").attr("transform","translate(0,4)").text(""):d3.select(t).append("div").attr("class","title text-center").text(""),i.append("g").attr("class","slices"),i.append("g").attr("class","labels"),i.append("g").attr("class","lines"),i.attr("transform","translate("+e.width/2+","+e.height/2+")")}else{void 0!=e.debug&&console.log("existing chart - updating");var i=d3.select(t+" svg")}var d=Math.round(Math.min(e.width,e.height)/2)-e.padding;if(void 0!=e.type&&"donut"==e.type){void 0==e.donut&&(e.donut=.4);var o=d3.svg.arc().outerRadius(.8*d).innerRadius(d*e.donut)}else var o=d3.svg.arc().outerRadius(.85*d).innerRadius(0);var l=d3.svg.arc().innerRadius(.9*d).outerRadius(.9*d),s=function(t){return t.data.label},c=d3.layout.pie().value(function(t){return t.value}).sort(null);return void 0!=e.csv?(void 0!=e.debug&&console.log("loading csv"),d3.csv(e.csv,n)):void 0!=e.tsv?(void 0!=e.debug&&console.log("loading tsv"),d3.tsv(e.tsv,n)):void 0!=e.json?(void 0!=e.debug&&console.log("loading json"),d3.json(e.json,n)):void 0!=e.data&&(void 0!=e.debug&&console.log("loading data"),n(e.data)),!1}function wd3RandomPieData(){var t=d3.scale.ordinal().domain(["Lorem ipsum","dolor sit","amet","consectetur","adipisicing","eiusmod","tempor","incididunt"]),e=t.domain();return e.map(function(t){return{label:t,value:Math.random()}})}