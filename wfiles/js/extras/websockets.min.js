function websocketNotify(n){void 0==n&&(n="notify");var e=getObject("websocketAudio_"+n);if(void 0!=e)return e.currentTime=0,void e.play();var o=document.createElement("audio");o.id="websocketAudio_"+n;var i=document.createElement("source");i.src=n+".ogg",i.type="audio/ogg",o.appendChild(i),i.src=n+".webm",i.type="audio/webm",o.appendChild(i),i.src=n+".mp3",i.type="audio/mpeg",o.appendChild(i),i.src=n+".wav",i.type="audio/wav",o.appendChild(i),document.body.appendChild(o)}function websocketClient(n,e,o){void 0==o&&(o={}),void 0==o.filter&&(o.filter=""),void 0==o.sound&&(o.sound=""),void 0==o.inp&&(o.inp=1);var i=new websocketConnection(e);return n=getObject(n),i.buildgui(n,o.inp),i.params=o,1==o.inp&&(i.inputwindow.onkeypress=function(n){if(13==n.keyCode&&this.value){i.logmessage('<span class="icon-user w_grey"></span> You: '+this.value);var e={};e.source="user",e.message=this.value,e.icon="icon-user",i.send("message",JSON.stringify(e)),this.value=""}},i.logwindow.onkeypress=function(n){i.inputwindow.focus(),i.inputwindow.value=n.key}),i.bind("open",function(){i.logmessage('<span class="icon-mark w_success"></span> Connected');for(var n in i.params)if("inp"!=n&&"sound"!=n&&0!=i.params[n].length)for(var e=i.params[n].split(","),o=0;o<e.length;o++){var t={};t.message="/"+n+" "+e[o],i.send("message",JSON.stringify(t))}}),i.bind("close",function(n){i.logmessage('<span class="icon-close w_danger"></span> Disonnected')}),i.bind("message",function(n){i.logmessage(n),i.params.sound.length&&websocketNotify(i.params.sound)}),i.connect(),!1}var websocketConnection=function(n){var e={};this.bind=function(n,o){return e[n]=e[n]||[],e[n].push(o),this},this.send=function(n,e){return this.conn.send(e),this},this.connect=function(){"function"==typeof MozWebSocket?this.conn=new MozWebSocket(n):this.conn=new WebSocket(n),this.conn.onmessage=function(n){o("message",n.data)},this.conn.onclose=function(){o("close",null)},this.conn.onopen=function(){o("open",null)}},this.disconnect=function(){this.conn.close()},this.setfocus=function(){},this.logmessage=function(n){if(void 0==this.logwindow)return!1;var e=document.createElement("div");e.style.borderBottom="1px dashed #ccc",e.innerHTML=n,this.logwindow.appendChild(e),this.logwindow.scrollTop=this.logwindow.scrollHeight-this.logwindow.clientHeight},this.buildgui=function(n,e){return void 0==e&&(e=1),n=getObject(n),void 0==n&&(n=document.querySelector(n)),void 0==n?(console.log("websocketConnection gui error - gui object does not exist"+gui),!1):(this.logwindow=document.createElement("div"),this.logwindow.style.height="400px",this.logwindow.style.overflow="auto",this.logwindow.style.backgroundColor="#FFF",this.logwindow.style.border="1px solid #ccc",this.logwindow.style.padding="6px 12px",this.logwindow.style.borderRadius="4px",this.logwindow.style.boxShadow="0 1px 1px rgba(0, 0, 0, 0.075) inset",n.appendChild(this.logwindow),void(1==e&&(this.inputwindow=document.createElement("input"),this.inputwindow.className="form-control",this.inputwindow.type="text",n.appendChild(this.inputwindow),this.inputwindow.focus())))};var o=function(n,o){var i=e[n];if("undefined"!=typeof i)for(var t=0;t<i.length;t++)i[t](o)}};